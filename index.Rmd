---
title: "The influence of popularity on Tame Impala"
author: "Puck Voorham"
date: "2023-02-21"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

```{r, echo=FALSE}

library(tidyverse)
library(plotly)
library(spotifyr)
library(compmus)

```
### Introduction

***
This is text 

### A first visualisation

```{r}
Before_Currents <- get_playlist_audio_features("", "0zj7vBkFkrtkIy7bbiIDHT")
After_Currents <- get_playlist_audio_features("", "2iF5St3YBr1AalBJFZK8uD")

Categorical <- rbind(Before_Currents, After_Currents)

Categorical |>
  ggplot(aes(x = playlist_name, y = danceability )) +
  geom_violin() + theme_minimal() +
  theme(
    text = element_text( color = "white"),
    plot.subtitle = element_text(size = 12, color = "white"),
    plot.background = element_rect(fill = "lightblue"),
    plot.margin = unit(c(5, 10, 5, 10), units = "mm")
  ) 
```

*** 
In this first, relatively simple plot, the music used in this corpus is divided into two categories. The left form includes all songs by Tame Impala up to the Currents album in 2015. The right concerns all songs from 2015 (including Currents) to the present. In this plot, these categories are set out on the y-axis in "danceability". The expectation here was that earlier songs, before the popular album currents, were less danceable. This was the expectation because these songs could be considered more like Tame-Impala's somewhat inaccessible, rougher psychedelic rock. In short; music that could be perceived as less danceable than the smooth, disco- and synthpop-influenced songs from currents and other later tracks. The plot does somewhat support this expectation. It can be seen that at least the "peak" in danceability of the songs before currents is lower than the peak of the songs after currents. There is also less variation seen in the second group. First, the songs barely seem to score below a score of 0.4 in danceability, confirming the hypothesis. On the other hand, a single/some songs do seem to score higher in danceability than the songs after currents. To find out what this is due to requires further analysis. It could be that the whole variation in the first category is significantly higher because this category contains more songs.  


### A second visualisation

```{r}
scatter_plot <- ggplot(Categorical, aes(x = valence, y = energy, size = tempo, color = playlist_name)) +
  geom_point() +
  labs(
    x = "Valence",
    y = "Energy"
  ) + theme_minimal() +
  theme(
    text = element_text( color = "white"),
    plot.subtitle = element_text(size = 12, color = "white"),
    plot.background = element_rect(fill = "lightblue"),
    plot.margin = unit(c(5, 10, 5, 10), units = "mm")
  ) 

scatter_plot

```


***
deze plot is 


### Chromagram test

```{r}

Categorical <-
  get_tidy_audio_analysis("5JWPUEov2wlX7c0jhYZpeB") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)


Categorical |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  theme(
    text = element_text( color = "white"),
    plot.subtitle = element_text(size = 12, color = "white"),
    plot.background = element_rect(fill = "lightblue"),
    plot.margin = unit(c(5, 10, 5, 10), units = "mm")
  ) +
  scale_fill_viridis_c()
```


*** 
Here is a chromagram of the song Lost in Yesterday. In this song from Tame Impala's latest album, there are clear characteristics of disco, synth-pop and funk in addition to psychedelic influences. 

### Chromagram test

```{r}

Categorical <-
  get_tidy_audio_analysis("79chzfFIIq7cHkqcYYORk0") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)


Categorical |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  theme(
    text = element_text( color = "white"),
    plot.subtitle = element_text(size = 12, color = "white"),
    plot.background = element_rect(fill = "lightblue"),
    plot.margin = unit(c(5, 10, 5, 10), units = "mm")
  ) +
  scale_fill_viridis_c()
```

*** 
Does this work?


### Ceptrogram
```{r}
phf <-
  get_tidy_audio_analysis("1KcOU0q9AMXV9xi4tSzzCc") |> # Change URI.
  compmus_align(beats, segments) |>                     # Change `bars`
  select(beats) |>                                      #   in all three
  unnest(beats) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

phf |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +                              
  theme_classic()
```

### Conclusion

***
Here I would write my overall conclusions so far
