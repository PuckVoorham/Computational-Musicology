---
title: "The influence of popularity on Tame Impala  |"
author: "Puck Voorham"
date: ""
output: 
  flexdashboard::flex_dashboard:
    self_contained: false
    theme:
      version: 4
      bootswatch: minty
---

```{r, echo=FALSE}

library(tidyverse)
library(ggplot2)
library(plotly)
library(spotifyr)
library(compmus)
library(tidymodels)
library(ggdendro)
library(heatmaply)
library(compmus)
library(viridisLite)


my_palette <- viridis_pal(option = "viridis")(10)


```


Introduction
=====================================

Column {data-width=700}
-------------------------------------

### Does the genre of a major music phenomenon like Tame Impala change due to popularity?

Tame Impala is a famous musical project led by Kevin Parker, mostly known for its psychedelic rock. With the 2015 album Currents, it made its breakthrough to the greater public and has continued to grow in listeners over the past few years. Interestingly, best-known songs from the exploded album are quite "mild" by psychedelic-rock standards. Since this somewhat softer version of the genre seems to be doing well, I am curious to what extent a music phenomenon like Tame Impala, in genre 'adapts' after success, relative to their earlier songs. Do they make what the general public wants to hear, or do they maintain their authentic style for a smaller group of psychedelic-rock fanatics?

The groups I want to compare within this corpus will be, first, the first singles from 2008 and 2009, the first album Innerspeaker from 2010 and Lonerism from 2013. The second group includes all the songs from the album Currents, with which they broke through, until now.  

The expectations I have at this moment are therefore that their earlier songs can be considered as harder, rougher, up-tempo and less "accessible" psychedelic rock, while the songs from Currents and thus everything that followed fit better within the genres alternative/indie and (synth)pop.

Songs that, in my opinion, typify both extremes in this are The Bold Arrow of Time from the album Innerspeaker (2010) as typical hard psychedelic rock versus The less I know the better from Currents (2015). Songs like Nangs and Gossip from that same album might be a bit off, as they could be better considered as ambient music and are hard to categorize in any of the aforementioned genres.


Column {data-width=200}
-------------------------------------

### Corpus group 1: Songs before "Currents" 


<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/0zj7vBkFkrtkIy7bbiIDHT?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>



Column {data-width=200}
-------------------------------------

### Corpus group 2: Songs from "Currents" and later

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/2iF5St3YBr1AalBJFZK8uD?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>


A first impression {.storyboard}
=====================================


### The role of Danceability, Loudness and Energy in this corpus

```{r}

Before_Currents <- get_playlist_audio_features("", "0zj7vBkFkrtkIy7bbiIDHT")
Currents_and_later <- get_playlist_audio_features("", "2iF5St3YBr1AalBJFZK8uD")

Categorical <- rbind(Before_Currents, Currents_and_later)

ggplot(Categorical, aes(x = danceability, y = energy, size = loudness, color = playlist_name)) +
geom_point(alpha = 0.5) +
scale_x_continuous(limits = c(0, 1), breaks = c(0, 0.50, 1), minor_breaks = NULL) +
scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.50, 1), minor_breaks = NULL) +
scale_color_manual(values = c("#9900cc", "#009999")) +
scale_size_continuous(trans = "exp", range = c(1, 10), guide = guide_legend(override.aes = list(size = c(1, 3, 5)))) +
theme_light() +
labs(x = "Danceability", y = "Energy", size = "Loudness", color = "Corpus Group",
     title = "Visualisation of danceability and energy by corpus group ")


```

---

To get a first impression of the information we could extract from the corpus using the spotify API, it is important to know which characteristic features are useful to compare.

This is important because the corpus groups are not "totally" different; we are looking for certain characteristics in which to distinguish them. I have therefore chosen to focus on where "psychedelic rock" is fundamentally different from "pop". I chose these two genres because, based on chosic, the first corpus group leaned more toward the first genre (psychedelic rock) and the second corpus group showed more characteristics of pop. 

Danceability, volume and energy seem to be the characteristics on which the above genres differ most. Pop is generally more danceable, but has a lower volume than psychedelic rock (this volume is mainly created in instrumental interludes). With this, the overall energy of psychedelic rock songs is also higher on average (Adorno, Theodor W., (1942) "On Popular Music", Institute of Social Research), (Pete Prown; Harvey P. Newquist (1997). Legends of Rock Guitar: The Essential Reference of Rock's Greatest Guitarists. Hal Leonard Corporation).

This first plot reflects these three characteristics. From this visualization we can conclude a number of things. One property in which the clearest difference can be seen between the two groups is "loudness"; the songs from before currents are clearly louder on average than those after, as the literature led us to expect. In energy, we also see this very slightly. A similar subtle confirmation of expectation can be seen in danceability, which seems to be slightly higher for the newer songs. Still, we can hardly call this a significant result. 


### Danceability as a first key factor

```{r}
Before_Currents <- get_playlist_audio_features("", "0zj7vBkFkrtkIy7bbiIDHT")
Currents_and_later <- get_playlist_audio_features("", "2iF5St3YBr1AalBJFZK8uD")

Categorical <- rbind(Before_Currents, Currents_and_later)

Categorical |>
  
  ggplot(aes(x = playlist_name, y = danceability, box = FALSE )) +
  geom_violin(fill = "lightblue", color = "lightblue") + 
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  theme_minimal() +
  labs(x = "Corpus Group", y = "Danceability",
  title = "Visualisation of danceability by corpus group") +
  theme(
    plot.subtitle = element_text(size = 12, color = "black"),
    panel.background = element_rect(fill = "white"),
    plot.margin = unit(c(5, 10, 5, 10), units = "mm")
  )

```

---

If we then zoom in a bit more on this danceability, we might find something interesting after all. Indeed, the average seems quite similar, but the range of danceability is clearly much more diverse than Tame Impala's later songs. It can be seen that at least the "peak" in danceability of the songs before currents is lower than the peak of the songs after currents. There is also less variation seen in the second group. First, the songs barely seem to score below a score of 0.4 in danceability, confirming the hypothesis. On the other hand, a single/some songs do seem to score higher in danceability than the songs after currents. Still, the possibility that the wider range is caused by uber-more songs in the first corpus group should not be overlooked. 


### Loudness as a second important characteristic

```{r}
plot_ly() %>%
  add_trace(data = Before_Currents, x = ~loudness, type = "histogram", 
            histnorm = "probabilty density", name = "Before Currents", 
            marker = list(color = "#9900cc", opacity = 0.3)) %>%
  add_trace(data = Currents_and_later, x = ~loudness, type = "histogram", 
            histnorm = "probabilty density", name = "Currents And Later", 
            marker = list(color = "#009999", opacity = 0.3))%>%
  layout(xaxis = list(title = "Loudness"), yaxis = list(title = "Density"),
         title = "Loudness",
         showlegend = TRUE,
         legend = list(title = "", orientation = "h"))
```

("#9900cc", "#009999"


---

hfkhkanjbgkbnsjkBajkjv


### Energy as a third major indicator

```{r}

```

---


Chromagram
=====================================

Column {data-width=500}
-------------------------------------

### text 
Here is a chromagram of the song Lost in Yesterday. In this song from Tame Impala's latest album, there are clear characteristics of disco, synth-pop and funk in addition to psychedelic influences. 

Column {data-width=500}
-------------------------------------

### Chromagram 1

```{r}

lost_in_yesterday <-
  get_tidy_audio_analysis("5JWPUEov2wlX7c0jhYZpeB") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)


chromagram_1 <- lost_in_yesterday |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  
  geom_tile() +
  ggtitle("Chromagram: Lost In Yesterday") +
  scale_fill_gradientn(colors = my_palette) +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() + 
  scale_color_gradientn(colors = my_palette)
  ggplotly(chromagram_1, tooltip = "none", source = "none")
  
```

### Chromagram 2 

```{r}

the_bold_arrow_of_time <-
  get_tidy_audio_analysis("7r7yAFxq6CwakQB5NrJskh") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)


chromagram_2 <- the_bold_arrow_of_time |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  

  geom_tile() +
  ggtitle("Chromagram: The Bold Arrow Of Time") + 
  scale_fill_gradientn(colors = my_palette) +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() + 
  scale_color_gradientn(colors = my_palette)
  ggplotly(chromagram_2, tooltip = "none", source = "none")
  
```

Ceptrograms
=====================================

Column {.tabset}
-------------------------------------

### Ceptrogram 1
```{r}
the_sun_ceptrogram <- readRDS(file = "data/the_sun_ceptrogram (Ceptrogram).RDS")

the_sun_ceptrogram |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic()
```

### Ceptrogram 2

```{r}
disciples_ceptrogram <- readRDS(file = "data/disciples_ceptrogram (Ceptrogram).RDS")

disciples_ceptrogram |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +
  theme_classic()

```

Column {data-width=500}
-------------------------------------

### text 

On the left we see two ceptrograms



Self similarity matrices
=====================================

Column {data-width=500}
-------------------------------------

posthumous forgiveness 

Column {data-width=500}
-------------------------------------

### Self similarity matrix: ceptogram

```{r self similarity matrix}
SSM <- readRDS(file = "data/SSM (SSM).RDS")

SSM |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```

Tempograms
=====================================

Column {data-width=500}
-------------------------------------
    
### Tempo shifts as an indication of accessibility of music 
    
To analyze tempo, I used two typical songs from the different groups in my corpus. The first tempogram shows a number from before currents and the second shows one from after currents. It is interesting to note that the songs from before currents show more tempo changes than the songs after. Tempo changes could affect the extent to which a song can be considered accessible and danceable. The decrease in tempo changes in songs after currents could support the hypothesis. 
   
Column {data-width=500}
-------------------------------------

### Tempogram 1: elephant

```{r}
elephant_cyclic <- readRDS(file = "data/elephant_cyclic (Tempogram).RDS")

elephant_cyclic |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

### Tempogram 2: borderline
```{r}
borderline_cyclic <- readRDS(file = "data/borderline_cyclic (Tempogram).RDS")

borderline_cyclic |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()

```


Dendrogram
=====================================

Column {data-width=350}
-------------------------------------

in the dendrogram on the right you see a clustering analysis, in which I have divided my corpus into the two groups to be compared; songs from before currents and these from currents and after. The idea was to see to what extent in this analysis a separation could be seen between these two groups. Here and there we see some "correctly" clustered numbers; these are from the same corpus group (and often album, as in the middle blue chunk of numbers). Yet they are also occasionally mixed together. Nangs is a definite outlier, but this was to be expected. This song is the only one that is completely instrumental and can be classified more under "ambient" music rather than indie rock. Still, I wouldn't know exactly why, for example, "sundown syndrome" and "eventually" are clustered so closely together. I might change my clustering method to see if this has any influence. 

Column {data-width=650}
-------------------------------------

### Dendrogram
```{r}
data_for_tame_impala_clustering <- readRDS(file = "data/tame_impala_dendrogram (Dendrogram).RDS")


data_for_tame_impala_clustering |>
  ggdendrogram() +
  geom_text(data = label(data_for_tame_impala_clustering),aes(x, y,
                                                         label=label,
                                                         hjust=0,
                                                         colour=playlist_name), size=3) +
  coord_flip() +
  scale_y_reverse(expand=c(0.2, 0)) +
  theme(axis.line.y=element_blank(),
        axis.ticks.y=element_blank(),
        axis.text.y=element_blank(),
        axis.title.y=element_blank(),
        panel.background=element_rect(fill="white"),
        panel.grid=element_blank()) +
  labs(title = "Playlist Clustering") +
  scale_color_manual(values = c("#9900cc", "#009999")) +
  guides(
    colour = guide_legend(
      title = "Playlist"
    )
  )
```



An interesting outlier
=====================================

Column {data-width=500}
-------------------------------------

### Text

As 

Column {data-width=500}
-------------------------------------

### Chordogram 
```{r}
circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )

gossip <-
  get_tidy_audio_analysis("79chzfFIIq7cHkqcYYORk0") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )

gossip |> 
  compmus_match_pitch_template(
    chord_templates,         # Change to chord_templates if desired
    method = "manhattan",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
```


Track level summary
=====================================

Column {data-width=500}
-------------------------------------

In this visualization, you can see a comparison between the two groups within my chosen corpus: However, there is less variation than I expected beforehand in terms of timbre values. However, the second value (which says something about the "strength" of the high frequencies is significantly different. I am going to delve further into what exactly this difference means and whether I can recognize it myself. 

Column {data-width=500}
-------------------------------------

### Track level summary

```{r}

track_level_summary <- readRDS(file = "data/track_level_summary (track_level_summary).RDS")

track_level_summary |>
  mutate(
    timbre =
      map(
        segments,
        compmus_summarise,
        timbre,
        method = "mean"
      )
  ) |>
  select(genre, timbre) |>
  compmus_gather_timbre() |>
  ggplot(aes(x = basis, y = value, fill = genre)) +
  geom_violin() +
  scale_fill_viridis_d() +
  labs(x = "Spotify Timbre Coefficients", y = "", fill = "Genre")

```


Conclusion
=====================================

Column {data-width=1000}
-------------------------------------


### Conclusion

Here I would write my overall conclusions so far





























